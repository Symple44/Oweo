<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oweo - Expert ERP Charpente Métallique</title>
    <meta name="description" content="Conseil expert en transformation numérique pour entreprises de charpente métallique. Solutions ERP spécialisées et accompagnement personnalisé.">
    
    <!-- Preconnect pour optimiser les performances -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://assets.calendly.com">
    
    <!-- CSS Core dans l'ordre de priorité optimisé -->
    <link rel="stylesheet" href="css/variables.css" media="all">
    <link rel="stylesheet" href="css/base.css" media="all">
    <link rel="stylesheet" href="css/layout.css" media="all">
    <link rel="stylesheet" href="css/utilities.css" media="all">
    <link rel="stylesheet" href="css/animations.css" media="all">
    <link rel="stylesheet" href="css/buttons.css" media="all">
    <link rel="stylesheet" href="css/cards.css" media="all">
    <link rel="stylesheet" href="css/forms.css" media="all">
    <link rel="stylesheet" href="css/components.css" media="all">
    <link rel="stylesheet" href="css/navigation.css" media="all">
    <link rel="stylesheet" href="css/footer.css" media="all">
    <link rel="stylesheet" href="css/modals-notifications.css" media="all">
    <link rel="stylesheet" href="css/pages-specialized.css" media="all">
    <link rel="stylesheet" href="css/legal-pages.css" media="all">
    <!-- CSS Démos spécialisés -->
    <link rel="stylesheet" href="css/dstv-demo.css" media="all">
    <link rel="stylesheet" href="css/main.css" media="all">
    
    <!-- Calendly CSS -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    
    <!-- SEO et métadonnées -->
    <meta property="og:title" content="Oweo - Expert ERP Charpente Métallique">
    <meta property="og:description" content="Conseil expert en transformation numérique pour entreprises de charpente métallique">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oweo-consulting.fr">
    <meta property="og:image" content="https://oweo-consulting.fr/assets/og-image.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Oweo - Expert ERP Charpente Métallique">
    <meta name="twitter:description" content="Solutions ERP spécialisées et accompagnement personnalisé">
    
    <!-- Favicon et thème -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <meta name="theme-color" content="#00d4ff">
    <meta name="msapplication-TileColor" content="#00d4ff">
    
    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles CSS critiques intégrés pour éviter les erreurs de chargement -->
    <style>
        /* Reset minimal intégré pour éviter FOUC */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* Variables critiques intégrées */
        :root {
            --primary-color: #00d4ff;
            --secondary-color: #7c3aed;
            --accent-color: #ff6b35;
            --bg-dark: #0c1426;
            --bg-medium: #1a1f3a;
            --bg-light: #2d1b42;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-muted: rgba(255, 255, 255, 0.6);
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 50%;
            --transition-base: 0.3s ease;
            --transition-fast: 0.15s ease;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;
        }
        
        /* Styles de base critiques */
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: var(--line-height-normal);
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 50%, var(--bg-light) 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Loading spinner critique */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Overlay de chargement */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(12, 20, 38, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .loading-text {
            color: var(--text-secondary);
            margin-top: var(--space-4);
            font-size: var(--font-size-sm);
        }
        
        /* Conteneur principal */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Contenu de fallback optimisé */
        .gradient-text {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section {
            padding: var(--space-8) 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        /* Styles boutons critiques */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition-base);
            line-height: 1;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-secondary {
            background: var(--bg-medium);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        /* Responsive critique */
        @media (max-width: 768px) {
            :root {
                --space-4: 0.75rem;
                --space-6: 1rem;
                --space-8: 1.5rem;
            }
            
            .container {
                padding: 0 var(--space-3);
            }
        }
        
        /* États d'erreur */
        .error-fallback {
            text-align: center;
            padding: var(--space-8);
            color: var(--text-secondary);
        }
        
        .error-fallback h1 {
            color: var(--error-color);
            margin-bottom: var(--space-4);
        }
        
        /* Anti FOUC */
        .app-container {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .app-container.loaded {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar" class="navbar"></nav>
    
    <!-- Main App Container -->
    <main id="app" class="app-container">
        <!-- Contenu initial de fallback optimisé avec détection d'erreurs -->
        <div class="section">
            <div class="container">
                <div style="text-align: center; padding: 4rem 0;">
                    <h1 class="gradient-text" style="font-size: clamp(2rem, 5vw, 3rem); margin-bottom: 2rem; line-height: 1.2;">
                        Oweo - Expert ERP Charpente Métallique
                    </h1>
                    <p style="font-size: 1.25rem; color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6;">
                        Transformation digitale pour entreprises de métallurgie
                    </p>
                    <div class="loading-spinner" style="margin: 2rem auto;"></div>
                    <p style="color: var(--text-muted); font-size: 0.875rem;">
                        Chargement de l'application...
                        <br>
                        <small id="loading-status">Initialisation des composants</small>
                    </p>
                    
                    <!-- Fallback si JavaScript est désactivé -->
                    <noscript>
                        <div style="margin-top: 2rem; padding: 1rem; background: var(--error-color); border-radius: var(--radius-md);">
                            <strong>JavaScript requis</strong><br>
                            Cette application nécessite JavaScript pour fonctionner correctement.
                        </div>
                    </noscript>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer id="footer" class="footer"></footer>
    
    <!-- Loading Indicator Global -->
    <div id="loading" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Chargement...</div>
    </div>
    
    <!-- Scripts avec gestion d'erreurs préalable et chargement optimisé -->
    <script>
        // Gestion d'erreurs globale préventive
        window.addEventListener('error', function(event) {
            // Gérer les erreurs de ressources CSS/JS manquantes
            if (event.filename && (event.filename.includes('.css') || event.filename.includes('.js'))) {
                console.warn('Ressource non trouvée:', event.filename);
                updateLoadingStatus('Ressource manquante détectée, continuation...');
                return true; // Empêche l'affichage de l'erreur
            }
            
            // Gérer les autres erreurs JavaScript
            console.error('Erreur JavaScript:', event.error);
            updateLoadingStatus('Erreur détectée, tentative de récupération...');
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.warn('Promise rejetée:', event.reason);
            updateLoadingStatus('Erreur promise détectée, continuation...');
            event.preventDefault();
        });
        
        // Variables globales pour le debug et l'état
        window.debugMode = true;
        window.loadingSteps = [];
        window.appState = {
            loaded: false,
            hasErrors: false,
            components: {
                router: false,
                clientAccess: false,
                pages: false,
                footer: false
            }
        };
        
        // Fonction de mise à jour du statut de chargement
        function updateLoadingStatus(message) {
            const statusEl = document.getElementById('loading-status');
            if (statusEl) {
                statusEl.textContent = message;
            }
            logStep(message);
        }
        
        function logStep(step) {
            if (window.debugMode) {
                const timestamp = new Date().toISOString();
                window.loadingSteps.push(`${timestamp}: ${step}`);
                console.log(`📋 ${step}`);
            }
        }
        
        // Détection de compatibilité du navigateur
        function checkBrowserCompatibility() {
            const features = {
                es6: typeof Symbol !== 'undefined',
                fetch: typeof fetch !== 'undefined',
                promise: typeof Promise !== 'undefined',
                localStorage: typeof Storage !== 'undefined'
            };
            
            const isCompatible = Object.values(features).every(Boolean);
            
            if (!isCompatible) {
                showCompatibilityError(features);
                return false;
            }
            
            return true;
        }
        
        function showCompatibilityError(features) {
            document.getElementById('app').innerHTML = `
                <div class="error-fallback">
                    <h1>⚠️ Navigateur Non Supporté</h1>
                    <p>Votre navigateur ne supporte pas toutes les fonctionnalités requises.</p>
                    <ul style="text-align: left; max-width: 400px; margin: 2rem auto;">
                        ${Object.entries(features).map(([feature, supported]) => 
                            `<li style="color: ${supported ? 'var(--success-color)' : 'var(--error-color)'}">
                                ${supported ? '✅' : '❌'} ${feature}
                            </li>`
                        ).join('')}
                    </ul>
                    <p>Veuillez utiliser un navigateur moderne comme Chrome, Firefox, Safari ou Edge.</p>
                </div>
            `;
        }
        
        // Système de timeout pour éviter les blocages
        let appLoadTimeout;
        
        function startAppLoadTimeout() {
            appLoadTimeout = setTimeout(() => {
                if (!window.appState.loaded) {
                    console.error('Timeout de chargement de l\'application');
                    showTimeoutError();
                }
            }, 15000); // 15 secondes
        }
        
        function clearAppLoadTimeout() {
            if (appLoadTimeout) {
                clearTimeout(appLoadTimeout);
                appLoadTimeout = null;
            }
        }
        
        function showTimeoutError() {
            document.getElementById('app').innerHTML = `
                <div class="error-fallback">
                    <h1>⏱️ Timeout de Chargement</h1>
                    <p>L'application met trop de temps à se charger.</p>
                    <div style="margin: 2rem 0;">
                        <button class="btn btn-primary" onclick="location.reload()">
                            🔄 Recharger la page
                        </button>
                    </div>
                    <details style="margin-top: 2rem; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                        <summary>Détails techniques</summary>
                        <pre style="background: var(--bg-dark); padding: 1rem; border-radius: var(--radius-md); font-size: 0.75rem; overflow: auto; margin-top: 1rem;">
État des composants:
${Object.entries(window.appState.components).map(([name, loaded]) => `${name}: ${loaded ? 'OK' : 'ERREUR'}`).join('\n')}

Étapes de chargement:
${window.loadingSteps.join('\n')}
                        </pre>
                    </details>
                </div>
            `;
        }
        
        // Fonction de finalisation du chargement
        function finalizeAppLoad() {
            try {
                clearAppLoadTimeout();
                
                // Marquer l'app comme chargée
                const appContainer = document.querySelector('.app-container');
                if (appContainer) {
                    appContainer.classList.add('loaded');
                }
                
                window.appState.loaded = true;
                updateLoadingStatus('Application chargée avec succès !');
                
                // Cacher le contenu de fallback après un délai
                setTimeout(() => {
                    const loadingContent = document.querySelector('#app .section');
                    if (loadingContent && window.router && window.router.currentRoute) {
                        loadingContent.style.display = 'none';
                    }
                }, 1000);
                
                logStep('✅ Application entièrement chargée et opérationnelle');
                
            } catch (error) {
                console.error('Erreur finalisation chargement:', error);
            }
        }
        
        // Initialisation
        logStep('🚀 Initialisation de l\'application Oweo');
        updateLoadingStatus('Vérification de la compatibilité...');
        
        if (checkBrowserCompatibility()) {
            startAppLoadTimeout();
            updateLoadingStatus('Chargement des composants principaux...');
        }
    </script>
    
    <!-- Scripts principaux dans l'ordre de dépendance -->
    <!-- 1. Configuration et utilitaires de base -->
    <script>
        // Configuration globale de base (inline pour éviter les erreurs de chargement)
        window.OweoConfig = window.OweoConfig || {
            version: '2.0.0',
            environment: 'production',
            company: {
                name: 'Oweo',
                tagline: 'Expert ERP Charpente Métallique'
            },
            contact: {
                email: 'contact@oweo-consulting.fr',
                phone: '+33 (0)2 xx xx xx xx',
                address: {
                    city: 'Nantes, France'
                },
                social: {
                    linkedin: 'https://linkedin.com/company/oweo-consulting'
                }
            },
            urls: {
                calendly: 'https://calendly.com/oweo-consulting'
            }
        };
        
        logStep('Configuration globale chargée');
        updateLoadingStatus('Configuration initialisée...');
    </script>
    
    <!-- 2. Système d'accès client (critique pour les démos) -->
    <script src="js/utils/client-access.js" 
            onerror="console.warn('Erreur chargement client-access.js'); window.appState.components.clientAccess = false;"
            onload="window.appState.components.clientAccess = true; logStep('✅ Système d\'accès client chargé');">
    </script>
    
    <!-- 3. Configuration des démos -->
    <script src="js/config/client_demos.js" 
            onerror="console.warn('Erreur chargement client_demos.js');"
            onload="logStep('✅ Configuration démos chargée');">
    </script>
    
    <!-- 4. Utilitaires (bouton retour, etc.) -->
    <script src="js/utils/back-button.js" 
            onerror="console.warn('Erreur chargement back-button.js');"
            onload="logStep('✅ Utilitaires de navigation chargés');">
    </script>
    
    <!-- 5. Routeur (système de navigation) -->
    <script src="js/core/router.js" 
            onerror="console.warn('Erreur chargement router.js'); window.appState.components.router = false;"
            onload="window.appState.components.router = true; logStep('✅ Routeur chargé');">
    </script>
    
    <!-- 6. Pages principales -->
    <script src="js/pages/home.js" 
            onerror="console.warn('Erreur chargement home.js');"
            onload="logStep('✅ Page d\'accueil chargée');">
    </script>
    <script src="js/pages/services.js" 
            onerror="console.warn('Erreur chargement services.js');"
            onload="logStep('✅ Page services chargée');">
    </script>
    
    <!-- 7. Pages des démos (chargement différé OK car elles sont chargées dynamiquement) -->
    <script src="js/pages/outil-chiffrage-demo.js" 
            onerror="console.warn('Erreur chargement outil-chiffrage-demo.js');"
            onload="logStep('✅ Démo chiffrage chargée');">
    </script>
    <script src="js/pages/dstv-demo-page.js" 
            onerror="console.warn('Erreur chargement dstv-demo-page.js');"
            onload="logStep('✅ Démo DSTV chargée');">
    </script>
    
    <!-- 8. Composants UI -->
    <script src="js/components/navbar.js" 
            onerror="console.warn('Erreur chargement navbar.js');"
            onload="logStep('✅ Navbar chargée');">
    </script>
    <script src="js/components/footer.js" 
            onerror="console.warn('Erreur chargement footer.js'); window.appState.components.footer = false;"
            onload="window.appState.components.footer = true; logStep('✅ Footer chargé');">
    </script>
    
    <!-- 9. Script d'initialisation principal -->
    <script>
        // Initialisation de l'application avec gestion d'erreurs robuste
        document.addEventListener('DOMContentLoaded', function() {
            try {
                logStep('DOM prêt, initialisation des composants...');
                updateLoadingStatus('Initialisation des composants...');
                
                // Vérifier les composants critiques
                const criticalComponents = ['router', 'clientAccess'];
                const missingCritical = criticalComponents.filter(comp => !window.appState.components[comp]);
                
                if (missingCritical.length > 0) {
                    console.warn('Composants critiques manquants:', missingCritical);
                    updateLoadingStatus(`Composants manquants: ${missingCritical.join(', ')}`);
                    
                    // Continuer avec les composants disponibles
                    setTimeout(() => {
                        initializeAvailableComponents();
                    }, 2000);
                } else {
                    // Tous les composants critiques sont présents
                    initializeAllComponents();
                }
                
            } catch (error) {
                console.error('Erreur initialisation DOMContentLoaded:', error);
                showInitializationError(error);
            }
        });
        
        function initializeAllComponents() {
            try {
                updateLoadingStatus('Initialisation du routeur...');
                
                // Initialiser le routeur
                if (window.router && typeof window.router.init === 'function') {
                    window.router.init();
                    logStep('✅ Routeur initialisé');
                } else {
                    throw new Error('Routeur non disponible');
                }
                
                updateLoadingStatus('Initialisation des composants UI...');
                
                // Initialiser la navbar
                if (window.OweoNavbar) {
                    const navbar = new window.OweoNavbar();
                    navbar.init();
                    logStep('✅ Navbar initialisée');
                }
                
                // Initialiser le footer
                if (window.OweoFooter) {
                    const footer = new window.OweoFooter();
                    const footerElement = document.getElementById('footer');
                    if (footerElement) {
                        footerElement.innerHTML = footer.render();
                        footer.init();
                        logStep('✅ Footer initialisé');
                    }
                }
                
                updateLoadingStatus('Finalisation...');
                
                // Finaliser le chargement
                setTimeout(finalizeAppLoad, 500);
                
            } catch (error) {
                console.error('Erreur initialisation composants:', error);
                showInitializationError(error);
            }
        }
        
        function initializeAvailableComponents() {
            try {
                updateLoadingStatus('Mode dégradé: initialisation des composants disponibles...');
                
                // Initialiser seulement les composants disponibles
                let initializedCount = 0;
                
                if (window.router && typeof window.router.init === 'function') {
                    window.router.init();
                    initializedCount++;
                    logStep('✅ Routeur initialisé (mode dégradé)');
                }
                
                if (window.OweoNavbar) {
                    const navbar = new window.OweoNavbar();
                    navbar.init();
                    initializedCount++;
                    logStep('✅ Navbar initialisée (mode dégradé)');
                }
                
                if (window.OweoFooter) {
                    const footer = new window.OweoFooter();
                    const footerElement = document.getElementById('footer');
                    if (footerElement) {
                        footerElement.innerHTML = footer.render();
                        footer.init();
                        initializedCount++;
                        logStep('✅ Footer initialisé (mode dégradé)');
                    }
                }
                
                updateLoadingStatus(`Mode dégradé: ${initializedCount} composants initialisés`);
                
                // Finaliser avec un délai plus long
                setTimeout(finalizeAppLoad, 1500);
                
            } catch (error) {
                console.error('Erreur initialisation mode dégradé:', error);
                showInitializationError(error);
            }
        }
        
        function showInitializationError(error) {
            clearAppLoadTimeout();
            
            document.getElementById('app').innerHTML = `
                <div class="error-fallback">
                    <h1>❌ Erreur d'Initialisation</h1>
                    <p>Une erreur est survenue lors du chargement de l'application.</p>
                    <div style="margin: 2rem 0;">
                        <button class="btn btn-primary" onclick="location.reload()">
                            🔄 Recharger la page
                        </button>
                        <button class="btn btn-secondary" onclick="location.href='mailto:contact@oweo-consulting.fr'">
                            📧 Signaler le problème
                        </button>
                    </div>
                    <details style="margin-top: 2rem; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                        <summary>Détails de l'erreur</summary>
                        <pre style="background: var(--bg-dark); padding: 1rem; border-radius: var(--radius-md); font-size: 0.75rem; overflow: auto; margin-top: 1rem;">${error.message || error}</pre>
                    </details>
                </div>
            `;
        }
        
        // Fallback si DOMContentLoaded ne se déclenche pas
        setTimeout(function() {
            if (!window.appState.loaded && document.readyState === 'loading') {
                logStep('⚠️ DOMContentLoaded timeout, initialisation forcée');
                document.dispatchEvent(new Event('DOMContentLoaded'));
            }
        }, 3000);
        
        logStep('🏁 Scripts d\'initialisation chargés');
    </script>
    
    <!-- Calendly Scripts (externes, non critiques) -->
    <script src="https://assets.calendly.com/assets/external/widget.js" 
            async 
            onerror="console.warn('Calendly script non disponible');"
            onload="logStep('✅ Calendly chargé');">
    </script>
    
    <!-- Analytics et scripts non critiques -->
    <script>
        // Placeholder pour analytics (Google Analytics, etc.)
        // À implémenter selon les besoins
        
        // Script de performance monitoring simple
        window.addEventListener('load', function() {
            if (window.performance && window.performance.timing) {
                const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
                logStep(`📊 Temps de chargement total: ${loadTime}ms`);
                
                if (loadTime > 5000) {
                    console.warn('Temps de chargement élevé:', loadTime + 'ms');
                }
            }
        });
        
        logStep('📊 Monitoring de performance initialisé');
    </script>
</body>
</html>